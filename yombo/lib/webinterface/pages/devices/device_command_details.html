{% extends "lib/webinterface/fragments/layout.tpl" %}
{% import "lib/webinterface/fragments/macros.tpl" as macros%}

{% block content %}
<div class="row">
    <div class="col-lg-12">
        <h1 class="page-header"><a class="success" href="/devices/index"></a>
            Device Command Details<br>
        </h1>
        <p></p>
    </div>
    <!-- /.col-lg-12 -->
</div>
<!-- /.row -->
<div class="row">
    <div class="col-lg-6">
        <div class="panel panel-default">
            <div class="panel-heading">
                <h4>Basic Information</h4>
            </div>
            <!-- /.panel-heading -->
            <div class="panel-body">
                <label style="margin-top: 0px; margin-bottom: 0px">Status: </label><br>
                {{ device_command.status }}<br>
                <label style="margin-top: 15px; margin-bottom: 0px">Device: </label><br>
                {{ device_command.device.label }}<br>
                <label style="margin-top: 15px; margin-bottom: 0px">Command: </label><br>
                {{ device_command.command.label }}<br>
                <label style="margin-top: 15px; margin-bottom: 0px">Created Time: </label><br>
                {{ device_command.created_at|epoch_to_string }} ({{device_command.created_at|epoch_get_age}})<br>
                <label style="margin-top: 15px; margin-bottom: 0px">Broadcast Time: </label><br>
                {{ device_command.broadcast_at|epoch_to_string }} ({{device_command.broadcast_at|epoch_get_age}})<br>
                <label style="margin-top: 15px; margin-bottom: 0px">Accepted Time: </label><br>
                {{ device_command.accepted_at|epoch_to_string }} ({{device_command.accepted_at|epoch_get_age}})<br>
                <label style="margin-top: 15px; margin-bottom: 0px">Sent Time: </label><br>
                {{ device_command.sent_at|epoch_to_string }} ({{device_command.sent_at|epoch_get_age}})<br>
                <label style="margin-top: 15px; margin-bottom: 0px">Received Time: </label><br>
                {{ device_command.received_at|epoch_to_string }} ({{device_command.received_at|epoch_get_age}})<br>
                <label style="margin-top: 15px; margin-bottom: 0px">Pending Time: </label><br>
                {{ device_command.pending_at|epoch_to_string }} ({{device_command.pending_at|epoch_get_age}})<br>
                <label style="margin-top: 15px; margin-bottom: 0px">Finished Time: </label><br>
                {{ device_command.finished_at|epoch_to_string }} ({{device_command.finished_at|epoch_get_age}})<br>
                <label style="margin-top: 15px; margin-bottom: 0px">Not Before Time: </label><br>
                {{ device_command.not_before_at|epoch_to_string }} ({{device_command.not_before_at|epoch_get_age}})<br>
                <label style="margin-top: 15px; margin-bottom: 0px">Not After Time: </label><br>
                {{ device_command.not_after_at|epoch_to_string }} ({{device_command.not_after_at|epoch_get_age}})<br>
                <label style="margin-top: 15px; margin-bottom: 0px">Request Id: </label><br>
                {{ device_command.request_id }}<br>
                <label style="margin-top: 15px; margin-bottom: 0px">Persistent Request Id: </label><br>
                {{ device_command.persistent_request_id }}<br>
                <label style="margin-top: 15px; margin-bottom: 0px">Command Status Received:</label><br>
                {{ device_command.command_status_received|yes_no }}<br>
                <label style="margin-top: 15px; margin-bottom: 0px">Dirty Bit:</label><br>
                {{ device_command.dirty }}<br>
                <label style="margin-top: 15px; margin-bottom: 0px">Source:</label><br>
                {{ device_command.source }}<br>
            </div>
        </div>
        <!-- /.panel-body -->
    </div>
    <div class="col-lg-6">
        <div class="panel panel-default">
            <div class="panel-heading">
                <h4>Request Information</h4>
            </div>
            <!-- /.panel-heading -->
            <div class="panel-body">
                <label style="margin-top: 0px; margin-bottom: 0px">User Id: </label><br>
                {{ device_command.user_id }}<br>
                <label style="margin-top: 15px; margin-bottom: 0px">User Type: </label><br>
                {{ device_command.user_type }}<br>
                <label style="margin-top: 15px; margin-bottom: 0px">Requesting Source: </label><br>
                {{ device_command.requesting_source }}<br>
            </div>
        </div>
        <!-- /.panel-body -->
    </div>
</div>
<div class="row">
    <div class="col-lg-12">
        <div class="panel panel-default">
            <div class="panel-heading">
                <h4>Log</h4>
            </div>
            <!-- /.panel-heading -->
            <div class="panel-body">
                <table width="100%" class="table table-striped table-bordered table-hover">
                    <thead>
                        <tr>
                            <th>Time</th><th>Status</th><th>Source Gateway</th><th>Message</th>
                        </tr>
                    </thead>
                    <tbody>{% for history in device_command.history %}
                         <tr>
                            <td>{{ history['time']|epoch_to_string}}</td>
                            <td>{{ history['status']}}</td>
                            <td>{{ history['gid']}}</td>
                            <td>{{ history['msg']}}</td>
                         </tr>{% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
        <!-- /.panel-body -->
    </div>

        <h1 class="page-header"><a class="success" href="/devices/index"></a>
            Device Command Details<br>
        </h1>
        <p></p>
    </div>
    <!-- /.col-lg-12 -->
</div>

{% endblock %}

{% block body_bottom %}
<script type="text/javascript" src="/static/js/jquery.serializejson.min.js"></script>

    <!-- Make the tables pretty -->
    <script>
// Javascript to enable link to tab
var hash = document.location.hash;
var prefix = "tab_";
if (hash) {
    $('.nav-tabs a[href="'+hash.replace(prefix,"")+'"]').tab('show');
}

// Change hash for page-reload
$('.nav-tabs a').on('shown.bs.tab', function (e) {
    window.location.hash = e.target.hash;
    window.scrollTo(0, 0);
})



    </script>
{% endblock %}
