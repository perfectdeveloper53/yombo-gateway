{% extends "lib/webinterface/fragments/layout.tpl" %}
{% import "lib/webinterface/fragments/macros.tpl" as macros%}
{% block head_css %}{% include 'lib/webinterface/fragments/datatables_css.tpl' %}{% endblock %}

{% block content %}
<div class="row">
    <div class="col-lg-12">
        <h1 class="page-header">MQTT Log Viewer</h1>
    </div>
    <!-- /.col-lg-12 -->
</div>
<!-- /.row -->
<div class="row">
    <div class="col-lg-12">
        <ul class="nav nav-tabs">
          <li class="active"><a data-toggle="tab" href="#incoming">Incoming</a></li>
          <li><a data-toggle="tab" href="#outgoing">Outgoing</a></li>
        </ul>
        <div class="tab-content">
            <div id="incoming" class="tab-pane fade in active">
                <br>
                <div class="dataTable_wrapper">
                    <table width="100%" class="table table-striped table-bordered table-hover" id="dataTables-incoming">
                        <thead>
                            <tr>
                                <th>Sent Time<br>Received Time</th><th>Topic<br>Message</th>
                            </tr>
                        </thead>
                        <tbody>{% for entry in log_incoming %}
                             <tr>
                                <td>{{ entry.message.time_sent|epoch_to_human(milliseconds=True) }}<br> <br>
                                    {{ entry.received|epoch_to_human(milliseconds=True) }}</td>
                                 <td><strong>Topic:</strong>{{ entry.topic }}<br>
                                 <strong>Message ID:</strong>{{ entry.message.message_id }}<br>
                                 <strong>Source ID:</strong>{{ entry.message.source_id }}<br>
                                 <strong>Destination ID:</strong>{{ entry.message.destination_id }}<br>
                                 <strong>Payload:</strong> {{ entry.message.payload }}<br>
                                 </td>
                             </tr>{% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
            <div id="outgoing" class="tab-pane fade in">
                <br>
                <div class="dataTable_wrapper">
                    <table width="100%" class="table table-striped table-bordered table-hover" id="outgoingtb">
                        <thead>
                            <tr>
                                <th>Sent Time</th><th>Topic<br>Message</th>
                            </tr>
                        </thead>
                        <tbody>{% for entry in log_outgoing %}
                             <tr>
                                <td>{{ entry.sent|epoch_to_human }}</td>
                                 <td><strong>Topic:</strong>{{ entry.topic }}<br>
                                 <strong>Message ID:</strong>{{ entry.message.message_id }}<br>
                                 <strong>Source ID:</strong>{{ entry.message.source_id }}<br>
                                 <strong>Destination ID:</strong>{{ entry.message.destination_id }}<br>
                                 <strong>Payload:</strong> {{ entry.message.payload }}<br>
                             </tr>{% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <!-- /.col-lg-6 -->
</div>

{% endblock %}

{% block body_bottom_js %}{% include 'lib/webinterface/fragments/datatables_js.tpl' %}{% endblock %}

{% block body_bottom %}
    <!-- Make the tables pretty -->
    <script>
    $(document).ready(function() {
        $('#dataTables-incoming').DataTable({
                responsive: true,
                paging: true,
                iDisplayLength: 50
        });

        $('#outgoingtb').DataTable({
                responsive: true,
                paging: true,
                iDisplayLength: 50,
                order: [[ 0, "desc"], [0, "desc"]],
                "aoColumnDefs": [
                      { "bSearchable": false, "aTargets": [ 4 ] }
                    ]
//                lengthMenu: [ 1, 2, 50, 75, 100 ],
//                dom: '<f<t>ip>'

//                dom: 'il<"top"f>rt<"bottom"fl>p<"clear">'
        });


    });
    </script>
{% endblock %}