{% extends "lib/webinterface/fragments/layout.tpl" %}
{% block head_css %}{% include 'lib/webinterface/fragments/datatables_css.tpl' %}{% endblock %}

{% block content %}
            <div class="row">
                <div class="col-lg-12">
                    <h1 class="page-header">GPG Key Management
                        <a style="float: right;" href="#" data-toggle=modal data-target=#myModal> <i class="fa fa-question-circle  fa-lg"></i></a>
                    </h1>
<!-- Modal -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="myModalLabel">Encryption Keys</h4>
      </div>
      <div class="modal-body">
           <p>
               Yombo uses public key encryption to protect sensitive data. In short: a public key is distributed and is used
               to encrypt data that only the private key can decrypt. The public and private key are created on the gateway
               during setup, only the public key is distributed outside the gateway.
           </p>
           <p>
               The Yombo Gateway uses a GPG implementation to support encryption. This allows various endpoints (such as
               other gateways, remote systems, mobile apps, etc) to send encrypted data to the gateway, such as commands or
               request device status.
           </p>
          <p>
              This page lists available keys to the system and allows various key management options.
          </p>
            <div class="bs-callout bs-callout-danger" id="callout-images-ie-rounded-corners">
                <h4>Protect system access</h4>
                <p>
                    It's important that access to the system be limited to trusted users. The private key is stored on
                    the system in a non-encrypted format.
                </p>
            </div>
            <div class="bs-callout bs-callout-danger" id="callout-images-ie-rounded-corners">
                <h4>Perform backups</h4>
                <p>
                    The private keys cannot be re-generated by any means. It is important to the regularly backup the 'usr'
                    directory within the Yombo directory as this contains various information, including the encryption
                    keys.
                </p>
            </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

                    <p></p>
                </div>
                <!-- /.col-lg-12 -->
            </div>
            <!-- /.row -->
            <div class="row">
                <div class="col-lg-12">
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            <h4>Encryption Keys</h4>
                            <p>Encryption keys are used to encrypt and decrypt sensitive data.
                            </p>
                            <p><strong>Be carefull here, mis-use can render devices and modules unusble.</strong></p>
                                <a href="/configs/gpg/new" class="btn btn-md btn-primary">Generate New GPG key</a>
                        </div>
                        <!-- /.panel-heading -->
                        <div class="panel-body">
                            <p><strong>Primary fingerprint: {{ gw_fingerprint }}</strong></p>
                            <br>
                           <div class="dataTable_wrapper">
                                <table width="100%" class="table table-striped table-bordered table-hover" id="dataTables-example">
                                    <thead>
                                        <tr>
                                            <th data-priority="1">Notes</th>
                                            <th data-priority="2">Key<br>Length</th>
                                            <th data-priority="4">Private<br>key avail</th>
                                            <th data-priority="1">Created</th>
                                            <th data-priority="1">Expires</th>
                                            <th data-priority="1">Key ID</th>
                                            <th data-priority="3">Fingerprint</th>
                                            <th data-priority="1">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>{% for fingerprint, key in gpg_keys.items() %}
                                         <tr>
                                             <td>{{ key.notes }}</td>
                                             <td>{{ key.length }}</td>
                                             <td>
                                             {% if key.have_private == 1
                                              %} {{ _('Yes') }} {%
                                             elif key.have_private == 0
                                              %} {{ _('No') }} {%
                                             endif %}
                                            </td>
                                            <td>{{ key.created_at|epoch_to_human }}</td>
                                            <td>{{ key.expires_at|epoch_to_human }}</td>
                                            <td>{{ key.keyid }}</td>
                                            <td>{{ fingerprint }}</td>
                                            <td> None </td>
                                         </tr>{% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    <!-- /.panel-body -->
                </div>
                <!-- /.col-lg-6 -->
            </div>
            <!-- /.row -->
{% endblock %}

{% block body_bottom_js %}{% include 'lib/webinterface/fragments/datatables_js.tpl' %}{% endblock %}

{% block body_bottom %}
    <!-- Make the tables pretty -->
    <script>
    $(document).ready(function() {
        $('#dataTables-example').DataTable({
                responsive: true,
                paging: true,
                iDisplayLength: 50
        });
    });
    </script>
{% endblock %}

