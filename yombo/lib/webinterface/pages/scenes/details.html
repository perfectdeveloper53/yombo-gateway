{% extends "lib/webinterface/fragments/layout.tpl" %}
{% import "lib/webinterface/pages/scenes/macros.tpl" as smacro%}

{% block head_css %}
<style>
/* supersede bootstrap at the row level by being annoyingly specific
*/
.table-striped > tbody > tr:nth-child(odd).highlight-device > td {
    background-color: #e4eaff;
}
.table-striped > tbody > tr:nth-child(even).highlight-device > td {
    background-color: #d6dcf1;
}
.table-striped > tbody > tr:nth-child(odd).highlight-pause > td {
    background-color: #fffef7;
}
.table-striped > tbody > tr:nth-child(even).highlight-pause > td {
    background-color: #fffef7;
}
.table-striped > tbody > tr:nth-child(odd).highlight-state > td {
    background-color: #e8ffea;
}
.table-striped > tbody > tr:nth-child(even).highlight-state > td {
    background-color: #daf1dc;
}
/* supersede bootstrap at the cell level by being annoyingly specific */
.table-striped > tbody > tr:nth-child(odd) > td.highlight {
	background-color:lightgreen;
}
[contenteditable="true"]:active,
[contenteditable="true"]:focus{
    outline: solid;
    outline-color: red;
    padding: 10px 10px 10px 10px;
}
</style>
{% endblock %}
{% block content %}
    <div class="row">
        <div class="col-lg-12">
            <h1 class="page-header has-buttons-under"><a class="success" href="/scenes/index" aria-label="Delete">
                <i class="fa fa-arrow-left" aria-hidden="true"></i></a> Scene: {{ scene.label}}
            </h1>
{% if scene.status == 0 %}
            <a class="btn btn-md btn-primary" href="/scenes/{{scene.scene_id}}/edit" title="Edit scene labels.">Edit Scene</a>
            <a class="btn btn-md btn-success" href="/scenes/{{scene.scene_id}}/enable">Enable Scene</a>
            <a class="btn btn-md btn-danger" href="/scenes/{{scene.scene_id}}/delete">Delete Scene</a>
{% elif scene.status == 1  %}
            <a class="btn btn-md btn-primary" href="/scenes/{{scene.scene_id}}/edit" title="Edit scene labels.">Edit Scene</a>
            <a class="btn btn-md btn-warning" href="/scenes/{{scene.scene_id}}/disable">Disable Scene </a>
            <a class="btn btn-md btn-danger" href="/scenes/{{scene.scene_id}}/delete">Delete Scene</a>
            <a class="btn btn-md btn-primary pull-right" href="/scenes/{{scene.scene_id}}/trigger" style="margin-left: 10px" title="Trigger scene">Start Scene</a>
            {%- if scene.scene_id in _scenes.scenes_running and  _scenes.scenes_running[scene.scene_id] == "running"%}
            <a class="btn btn-md btn-danger pull-right" href="/scenes/{{scene.scene_id}}/stop_trigger" title="Trigger scene">Stop Scene</a>
            {% else %}
            <a class="btn btn-md btn-danger disabled pull-right" href="/scenes/{{scene.scene_id}}/stop_trigger" title="Trigger scene">Stop Scene</a>
            {% endif %}
            &nbsp;
{% elif scene.status == 2  %}
            <a class="btn btn-md btn-success" href="/scenes/{{scene.scene_id}}/enable">Enable Scene</a>
{% endif %}
            <hr class="under-buttons">
        </div>
        <!-- /.col-lg-12 -->
    </div>
    <!-- /.row -->
    <div class="row">
        <div class="col-lg-12">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <label>Basic Information</label>
                </div>
                <!-- /.panel-heading -->
                <div class="panel-body">
                    <div class="row">
                        <div class="col-lg-4">
                            <label style="margin-top: 0px; margin-bottom: 0px">Label: </label><br>
                            <span  ondblclick="$(this).editable('col_a')">{{ scene.label }}</span><br>
                            <label style="margin-top: 15px; margin-bottom: 0px">Machine: </label><br>
                            {{ scene.machine_label }}<br>
                        </div>
                        <div class="col-lg-8">
                            <label style="margin-top: 0px; margin-bottom: 0px">Description: </label><br>
                            {{ scene.description }}<br>
                            <label style="margin-top: 15px; margin-bottom: 0px">Status: </label><br>
                            {{ scene.status|status_to_string }}<br>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-lg-12">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <label>Scene Items</label><br>
                     Add new:
                    <select name="new_item_type" id="new_item_type" required class="selectpicker show-tick" title="Select...">
                    <option value="/scenes/{{scene.scene_id}}/add_device">Device</option>
                    <option value="/scenes/{{scene.scene_id}}/add_pause">Pause</option>
                    <option value="/scenes/{{scene.scene_id}}/add_state">State</option>
                    <option value="/scenes/{{scene.scene_id}}/add_scene">Scene</option>
                    <option value="/scenes/{{scene.scene_id}}/add_template">Template</option>
                    </select>
                </div>
                <!-- /.panel-heading -->
                <div class="panel-body">
                    {% if scene.data['items']|length == 0 %}
                    <p>This scene doesn't have any items.</p>
                    <p><strong>Add the first item now.</strong></p>
                    <ul>
                        <li><a href="/scenes/{{scene.scene_id}}/add_device">Device</a> - Control a device</li>
                        <li><a href="/scenes/{{scene.scene_id}}/add_pause">Pause</a> - Pause a scene</li>
                        <li><a href="/scenes/{{scene.scene_id}}/add_state">State</a> - Change a state value</li>
                        <li><a href="/scenes/{{scene.scene_id}}/add_scene">Scene</a> - Control a scene</li>
                        <li><a href="/scenes/{{scene.scene_id}}/add_template">Template</a> - Advanced logic control</li>
                    </ul>

                    {% else %}
                    <table width="100%" class="table table-striped table-bordered table-hover" id="devices-enabled">
                        <thead>
                            <tr>
                                <th>Type / Label</th><th>Weight</th><th>Attributes</th><th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>{% for item_id, item in _scenes.get_item(scene.scene_id).items() %}
                             {%- if item['item_type'] == 'device' %} {{ smacro.display_device(scene, item_id, item) }}
                             {%- elif item['item_type'] == 'pause' %} {{ smacro.display_pause(scene, item_id, item) }}
                             {%- elif item['item_type'] == 'scene' %} {{ smacro.display_scene(scene, item_id, item) }}
                             {%- elif item['item_type'] == 'state' %} {{ smacro.display_state(scene, item_id, item) }}
                             {%- elif item['item_type'] == 'template' %} {{ smacro.display_template(scene, item_id, item) }}
                             {%- else %} <tr><td colspan="2">Unknown item type:{{item}} {{item['type']}} </td></tr>
                             {%- endif %}
                        {%- endfor %}
                        </tbody>
                    </table>
                    {% endif %}
                </div>
            </div>
        </div>
        <!-- /.col-lg-12 -->
    </div>
    <!-- /.row -->
{% endblock %}
{% block body_bottom_js %}{% include 'lib/webinterface/fragments/select_js.tpl' %}

<script>

    $(function(){
  // bind change event to select
  $('#new_item_type').on('change', function () {
      var url = $(this).val(); // get selected value
      if (url) { // require a URL
          window.location = url; // redirect
      }
      return false;
  });
});

jQuery(document).ready(function(){

    $.fn.editable = function(column){
        $(this).attr('contenteditable', true);

        $(this).blur(function () {
            var ajax = $.ajax({
                url: './aaaaaaaa',
                type: "POST",
                data: { row_id: $(this).parent().attr('id'), column:column, value: $(this).html()},
                dataType: "json"
            });
            ajax.done(function(data){
                $('#result').html(data.result);
            });

            $(this).attr('contenteditable', false);
        });
        return this;
    };
});
</script>
{% endblock %}
