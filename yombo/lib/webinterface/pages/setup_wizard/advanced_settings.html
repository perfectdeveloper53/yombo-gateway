{% extends "lib/webinterface/fragments/layout.tpl" %}
{% import "lib/webinterface/fragments/macros.tpl" as macros%}

{% block head_top %}
{% include "lib/webinterface/fragments/bg_image.tpl" %}
{% endblock %}

{% set progressbar = 70 %}

{% block content %}
<!-- Modals -->
<!-- Overview help -->
<div class="modal fade" id="localModal" tabindex="-1" role="dialog" aria-labelledby="localModalLabel">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header btn-primary">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="myModalLabel">Master or Slave</h4>
      </div>
      <div class="modal-body">
          <p>
              Only one gateway per location (a house, other house, etc) is required. This setting determines if this
              gateway is the master or primary gateway. If this is a slave gateway, simply select the master gateway
              from the drop down.
          </p>
          <p>
              Secondary gateways are typically used when wires for automation control cannot be run back to the
              master or it just doesn't make sense to (too far, too complex). Secondary gateways are the same except
              for the following:
              <ul>
                  <li>Statistics for devices are stored and processed on the master gateway.</li>
                  <li>Some modules handle all processing at the master, while the slaves only send sensor data and
                  can receive control data to perform actions.</li>
                  <li>Use USB or GPIO (relays and senors) over WIFI instead of long runs of wires.</li>
                  <li>The above use cases and more can be used from the same gateway.</li>
              </ul>
          </p>
          <p>
              A simple Raspberry PI (any version, we recommend version 3) or other low end device can be
              used as the master. Slave devices can even be slightly lower powered, such as the Raspberry PI Zero W.
              Secondary gateways will communicate with the primary and other slave gateways using a secure channel.
              This allows a master and secondary gateways to communicate over open networks (the internet).
          </p>
          <p>
              Use cases:
              <ul>
                  <li>Using various slaves allows for receiving and sending IR commands to each room to control devices.</li>
                  <li>Use a Raspberry Pi Zero in each room to collect signal strength of Bluetooth devices. This allows
                      the system to know which room someone is in if they keep their cell phone or other bluetooth device
                      with them. This allows for turning on lights or items based on who is in the room.</li>
                </ul>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<!-- Modal pop-up confirming data save and unable to return. -->
<div class="modal fade" id="confirm-submit" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header btn-primary">
            <h4 class="modal-title" id="">Confirm Submit</h4>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            </div>
            <div class="modal-body">
                <p><strong>Primary setup complete</strong></p>
                <p>
                    Primary settings are complete. Once you 'Save and Contine', you will not be able to return. Don't worry,
                    these settings are 100% changable after the gateway is running.
                </p>
                <p>
                    Continue to DNS?
                </p>
            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                <a href="#" id="submit" class="btn btn-success success">Save and Continue</a>
            </div>
        </div>
    </div>
</div>

{{ macros.modal("securitystatus", 'Send device status', '
<div class="alert alert-warning">
  <ul class="fa-ul">
    <li>
      <i class="fa fa-exclamation-triangle fa-li fa-lg"></i>
      Risk: Medium
    </li>
  </ul>
</div>
Sending device status allows you to access your device status externally. For example, if the
mobile app is not able to connect directly to your gateway, it can retrieve this information
from Yombo Servers.
<div class="bs-callout bs-callout-danger" id="callout-images-ie-rounded-corners">
    <h4>If disabled: May cause mobile app failures</h4>
    <p>The Yombo system was designed and implemented so that you can access your home automation system from anywhere,
    even if you cannot directly connect to your gateway while outside your local network.</p>
    <p>Disabling this field will
    prevent any mobile apps from accessing your device status if the mobile app cannot directly connect to your gateway.
    </p>
    <p>
        Disabling this will also disable modules that require this, for example, Amazon Alexa and Google Home may not
        be able to pull device status.
    </p>
</div>') }}

{{ macros.modal("securitysendprivatestats", 'Send private statistics to Yombo', '
<div class="alert alert-success">
  <ul class="fa-ul">
    <li>
      <i class="fa fa-exclamation-triangle fa-li fa-lg"></i>
      Risk: Very Low
    </li>
  </ul>
</div>
Device and system statistics allows you to view detailed trends and historical details online. This includes
energy used, device status trends, and more. It also acts as a backup to your data.
<div class="bs-callout bs-callout-success" id="callout-images-ie-rounded-corners">
    <h4>If disabled: No problem</h4>
    <p>You will not be able to see long term trends as easily.
    </p>
</div>') }}

{{ macros.modal("securitysendanonstats", 'Send anonymous statistics to Yombo', '
<div class="alert alert-success">
  <ul class="fa-ul">
    <li>
      <i class="fa fa-exclamation-triangle fa-li fa-lg"></i>
      Risk: Very Low
    </li>
  </ul>
</div>
Anonymous statistics includes system usage such as number of commands processed, number of dropped messages to/from the servers,
and more. This information helps us design a more robust system.
<div class="bs-callout bs-callout-success" id="callout-images-ie-rounded-corners">
    <h4>If disabled: No problem</h4>
    <p>The data will still be collected as it\'s hard carded into the code, but it won\'t be uploaded!
    </p>
</div>') }}

<form action="/setup_wizard/dns" method="POST" role="form" id="myForm">
    <div class="container-fluid">
        <div class="row" style="padding-top: 3em; padding-bottom: 2em;">
            <div class="col-12 col-xl-10 mx-auto">
                <div class="card">
                    <div class="card-header text-center">
                      <h2>Gateway Setup Wizard</h2>
                      <h5 class="card-title">Step 3: Basic Security Settings</h5>
                      <div class="progress">
                        <div class="progress-bar progress-bar-primary progress-bar-striped" role="progressbar"
                             aria-valuenow="{{ progressbar }}" aria-valuemin="2" aria-valuemax="100" style="min-width: 2em; width: {{ progressbar }}%">
                          {{ progressbar }}%
                        </div>
                      </div>
                    </div>
                    <div class="card-body">
                        <h2>Gateway Master / Slave
                            <a href="#" data-toggle=modal data-target=#localModal> <i class="fa fa-question fa-1x"></i></a>
                        </h2>
                        <br>
                        <div class="form-group">
                            <label for="master-gateway-id" data-toggle="tooltip" title="Select the master gateway.">
                                Select master gateway
                            </label>
                            <div class="pull-right">
                                <select name="master-gateway-id" id="master-gateway-id"
                                        required class="selectpicker show-tick" title="Select...">
                                    <option value="local" style="background: #e6f7ff; color: #000;"{%-
                                            if security_items.master_gateway_id == 'None' or security_items.is_master == 1 %} selected{%-
                                    endif %}>I'm the master!
                                    </option>
                                    <option data-divider="true"></option>
                                    {% for id, gateway in available_gateways.items() if gateway.is_master == '1' or gateway.is_master == 1  -%}
                                    <option value="{{ gateway.id }}"{%-
                                            if security_items.master_gateway_id == id %} selected{% endif %}>
                                        {{ gateway.label }}
                                    </option>
                                    {%- endfor %}
                                </select>
                                <label for="master-gateway-id" class="label-primary"></label>
                            </div>
                        </div>
                        <hr>
                        <h2>Basic Security Settings</h2>
                        <h5>Control the gateway's basic security settings.</h5>

                        <div class="form-group">
                            <label for="security-status" data-toggle="tooltip"
                                   title="Send device status to mobile and other connected devices.">
                                Allow device status to be sent to Yombo
                            </label>
                            &nbsp;<a href="#" data-toggle="modal" data-target="#securitystatus">
                            <i class="fa fa-question-circle"></i>
                            </a>
                            <div class="form-check checkbox-slider--a-rounded">
                                <input type="checkbox" id="security-status" name="security-status"
                                {% if security_items.status == '1' %} checked {% endif %}><span></span>
                            </div>
                        </div>

                        <div class="form-group">

                            <label for="security-send-private-stats" data-toggle="tooltip"
                                   title="Save private statistics information in the Yombo cloud.">
                                Allow private statistics information to be sent to Yombo
                            </label>
                            &nbsp;<a href="#" data-toggle="modal" data-target="#securitysendprivatestats">
                            <i class="fa fa-question-circle"></i></a>
                            <div class="form-check checkbox-slider--a-rounded">
                                <input type="checkbox" id="security-send-private-stats" name="security-send-private-stats"
                                {% if security_items.status == '1' %} checked {% endif %}><span></span>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="security-send-anon-stats" data-toggle="tooltip"
                                   title="Save statistics information in the Yombo cloud.">
                                Allow anonymous statistics information to be sent to Yombo
                            </label>
                            &nbsp;<a href="#" data-toggle="modal" data-target="#securitysendanonstats">
                            <i class="fa fa-question-circle"></i></a>
                            <div class="form-check checkbox-slider--a-rounded">
                                <input type="checkbox" id="security-send-anon-stats" name="security-send-anon-stats"
                                {% if security_items.status == '1' %} checked {% endif %}><span></span>
                            </div>
                        </div>
                        <a class="btn btn-md btn-warning" href="/setup_wizard/basic_settings">
                            <i class="fa fa-chevron-left float-left"> &nbsp; </i>Back</a>
                        <input type="button" name="btn" value="Next" id="submitBtn" class="btn btn-lg btn-success float-right"
                               data-toggle="modal" data-target="#confirm-submit" class="btn btn-default" />
                    </div>
                </div>
            </div>
        </div>
    </div>
</form>
{% endblock %}
{% block body_bottom %}

<script>
    $('.ls-modal').on('click', function(e){
      e.preventDefault();
      $('#myModal').modal('show').find('.modal-body').load($(this).attr('href'));
    });

        $('#submit').click(function(){
         /* when the submit button in the modal is clicked, submit the form */
        $('#myForm').submit();
    });

    $("form").submit(function () {
        var this_master = $(this);
        this_master.find('input[type="checkbox"]').each( function () {
            var checkbox_this = $(this);

            if( checkbox_this.is(":checked") == true ) {
                checkbox_this.attr('value','1');
            } else {
                checkbox_this.prop('checked',true);
                //DONT' ITS JUST CHECK THE CHECKBOX TO SUBMIT FORM DATA
                checkbox_this.attr('value','0');
            }
        })
    });

</script>

{% endblock %}

